<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Instinct Index | Behavioral Diagnostic</title>

    <!-- External libs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600;800&display=swap');
        :root {
            --brand-cyan: #00f0ff;
            --brand-teal: #2dd4bf;
            --deep-slate: #0f172a;
        }
        body {
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: radial-gradient(circle at 50% -20%, #1e293b 0%, #0f172a 100%);
            color: #f1f5f9;
            min-height: 100vh;
        }
        .serif { font-family: 'Libre Baskerville', serif; }
        .glass-card {
            background: rgba(30,41,59,0.75);
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(12px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
        }
        .title-ai { color: #fff; }
        .title-instinct { color: var(--brand-cyan); }
        .title-index { color: var(--brand-teal); }
        .likert-btn {
            background: rgba(15,23,42,0.6);
            border: 2px solid rgba(255,255,255,0.04);
            transition: all .18s;
        }
        .likert-btn.selected {
            background: var(--brand-cyan);
            border-color: var(--brand-cyan);
            color: #000;
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,240,255,0.18);
        }
        .pips-container { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin-bottom:1rem; }
        .pip { width:6px; height:6px; border-radius:999px; background:#334155; transition:all .18s; }
        .pip.active { background:var(--brand-cyan); transform:scale(1.25); box-shadow:0 0 8px var(--brand-cyan); }
        .pip.completed { background:var(--brand-teal); opacity:0.6; }
        .modal-overlay { position:fixed; inset:0; background:rgba(15,23,42,0.9); backdrop-filter:blur(6px); display:flex; align-items:center; justify-content:center; z-index:1000; }
        #chart-buffer { position:absolute; left:-9999px; visibility:hidden; }
    </style>
</head>
<body>
    <nav class="border-b border-white/5 bg-slate-900/80 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center space-x-2 cursor-pointer" onclick="app.navigate('hero')">
                <span class="font-black text-lg tracking-widest uppercase">
                    <span class="title-ai">AI</span> <span class="title-instinct italic serif">Instinct</span> <span class="title-index">Index</span>
                </span>
            </div>
            <div id="nav-actions" class="flex items-center space-x-6"></div>
        </div>
    </nav>

    <main id="view-port" class="max-w-6xl mx-auto px-4 py-12"></main>

    <div id="chart-buffer"><canvas id="radar-canvas" width="1000" height="1000"></canvas></div>

    <script>
    /* ===========================
       Data: 11 dimensions + 68 questions
       =========================== */
    const CONFIG = { ADMIN_PASS: "admin1510" };

    const dimensionsData = [
        { 
            name: "Exploration", 
            desc: "The cognitive drive to proactively investigate, experiment, and pilot emergent AI capabilities beyond mandated workflows.", 
            scientific: "Empirical data suggests that high Exploration scores correlate with reduced time-to-value in software deployments. It represents the 'Curiosity Quotient' applied to digital tools.", 
            dev: "Institutionalize 'Innovation Sprints' where experimentation is decoupled from immediate KPIs. Establish safe-to-fail sandboxes to lower the psychological barrier to entry.",
            checklist: [
                "Launch a 'Sandbox Hour' where teams test one new tool without KPI pressure.",
                "Reward 'failed' experiments that yield learning to reduce risk aversion.",
                "Curate a 'Tool of the Month' showcase to spark curiosity."
            ]
        },
        { 
            name: "Persistence", 
            desc: "The behavioral resilience required to troubleshoot hallucinations, non-deterministic outputs, and initial tool friction.", 
            scientific: "Iterative persistence is the primary differentiator between casual users and 'power users.' This dimension measures the tolerance for computational ambiguity.", 
            dev: "Reward the documentation of failure as much as success. Create a 'Prompt Library' where shared troubleshooting becomes organizational knowledge.",
            checklist: [
                "Create a 'Hallucination Log' to track and solve errors collectively.",
                "Shift focus from 'first-shot accuracy' to 'iterative refinement' metrics.",
                "Celebrate complex troubleshooting wins in team reviews."
            ]
        },
        { 
            name: "Integration", 
            desc: "The degree of alignment between AI use and established ethical, legal, and operational governance structures.", 
            scientific: "Unchecked integration poses systemic risk. High scores reflect an internalisation of governance as a facilitator rather than a constraint.", 
            dev: "Embed ethics checkpoints directly into tool interfaces. Conduct regular workshops on algorithmic bias and data privacy to maintain high awareness levels.",
            checklist: [
                "Draft a simple 'Ethics Checklist' for every AI output used externally.",
                "Clarify data privacy boundaries for specific tools explicitly.",
                "Audit one core workflow for potential bias annually."
            ]
        },
        { 
            name: "Influence", 
            desc: "Social contagion and peer-to-peer advocacy for AI adoption within internal professional networks.", 
            scientific: "Diffusion of Innovation theory posits that 'Influence' is the engine of the majority's adoption. This measures the peer-led network effect.", 
            dev: "Formalize internal 'Champion' roles. Implement peer-mentoring programs where high-influence individuals guide more hesitant colleagues.",
            checklist: [
                "Identify and resource one internal 'AI Champion' per unit.",
                "Host 'Lunch & Learn' sessions led by early adopters.",
                "Gamify peer-to-peer knowledge sharing to boost engagement."
            ]
        },
        { 
            name: "Psychology", 
            desc: "Socio-psychological security regarding professional identity and perceived replacement threats.", 
            scientific: "Identity threat is the leading cause of covert resistance. This dimension tracks the shift from 'replacement anxiety' to 'augmentation confidence'.", 
            dev: "Explicitly communicate AI as a 'Human-in-the-loop' augmentation tool. Highlight the displacement of mundane tasks to favor high-value creative work.",
            checklist: [
                "Explicitly frame AI as an 'Assistant' not a replacement in town halls.",
                "Highlight human-only skills (empathy, strategy) that AI amplifies.",
                "Address job security concerns transparently in 1-on-1s."
            ]
        },
        { 
            name: "Digital Temperament", 
            desc: "Comfort with probabilistic logic and non-deterministic technological environments.", 
            scientific: "Classic computing is binary; AI is probabilistic. This dimension measures the cognitive flexibility required for non-linear digital interactions.", 
            dev: "Educate staff on 'Confidence Intervals' in AI output. Shift performance metrics from 'Binary Correctness' to 'Weighted Accuracy' in experimental phases.",
            checklist: [
                "Train teams on probabilistic vs. deterministic outputs.",
                "Encourage 'multiple draft' workflows over single-answer expectations.",
                "Normalize the need for human verification of all outputs."
            ]
        },
        { 
            name: "Trust", 
            desc: "Confidence in institutional AI logic, transparency of systems, and the reliability of organizational outputs.", 
            scientific: "Trust is a multifaceted construct involving system reliability and human transparency. It is the foundation of long-term sustainable adoption.", 
            dev: "Promote Explainable AI (XAI) tools. Ensure leadership transparency regarding which AI systems are used and for what specific purposes.",
            checklist: [
                "Publish a transparency register of where AI is used.",
                "Explain the 'why' behind specific tool selections to staff.",
                "Validate high-stakes AI outputs with human SMEs."
            ]
        },
        { 
            name: "Leadership", 
            desc: "Executive commitment, resource allocation, and active behavioral role-modeling of AI proficiency.", 
            scientific: "Organizational culture is a shadow of leadership. This measures the executive 'buy-in' through visible action and funding allocation.", 
            dev: "Encourage leaders to share their personal AI use-cases. Implement reverse-mentoring where junior AI experts advise senior leadership teams.",
            checklist: [
                "Share your own personal learning curve with AI tools openly.",
                "Allocate specific budget for AI experimentation sprints.",
                "Model the use of AI in strategic planning sessions."
            ]
        },
        { 
            name: "Policy", 
            desc: "Clarity of institutional guardrails, incentivization structures, and evolving governance rules.", 
            scientific: "Policy lag often hampers innovation. This dimension measures the effectiveness and accessibility of the regulatory framework.", 
            dev: "Transition from static policy documents to dynamic 'Living Guidelines'. Simplify approved tool lists with clear, tiered access levels based on risk.",
            checklist: [
                "Create a 'Green/Yellow/Red' list of approved tools.",
                "Simplify approval processes for low-risk micro-experiments.",
                "Review AI governance guidelines quarterly for relevance."
            ]
        },
        { 
            name: "Benefit", 
            desc: "Tangible perception of quality, speed, or creative gains facilitated by AI tool usage.", 
            scientific: "The 'Value-Capture' perception determines sustained usage. Without visible benefit, adoption eventually regresses to the mean.", 
            dev: "Track and publish time-saved metrics across different departments. Highlight qualitative wins where AI enabled previously impossible creative feats.",
            checklist: [
                "Track 'hours saved' and reinvest them in creative work.",
                "Showcase 'Impossible without AI' case studies to the team.",
                "Link AI adoption to specific quality improvements, not just speed."
            ]
        },
        { 
            name: "Adoption", 
            desc: "Structural embedding of AI into core daily operations and longitudinal workflow consistency.", 
            scientific: "Adoption is the final stage of maturity, moving from pilot phases to 'business-as-usual' infrastructure. It reflects the normalization of AI.", 
            dev: "Monitor the 'Pilot-to-Scale' ratio. Ensure that successful AI experiments are systematically converted into standard operating procedures (SOPs).",
            checklist: [
                "Standardize successful prompts into team SOPs.",
                "Embed AI tools into the default software stack.",
                "Make AI proficiency a component of role descriptions."
            ]
        }
    ];

    const allQuestions = [
{ dIdx:0, text:"I regularly dedicate time to exploring new AI features before they are officially required." },
{ dIdx:0, text:"I am often the first among my peers to test a new AI application or update." },
{ dIdx:0, text:"I find experimentation with AI to be an energizing part of my professional development." },
{ dIdx:0, text:"I actively seek out 'beta' access to emerging AI tools to stay ahead of the curve." },
{ dIdx:0, text:"I find myself thinking about new ways AI could solve my current work challenges." },
{ dIdx:0, text:"I often research the technical mechanisms behind the AI tools I use daily." },

{ dIdx:1, text:"When an AI tool fails to give me the right output, I immediately try a different prompting strategy." },
{ dIdx:1, text:"I am willing to spend significant time 'fine-tuning' an AI response to get it exactly right." },
{ dIdx:1, text:"Technical errors in AI tools rarely discourage me from using them again." },
{ dIdx:1, text:"I view AI 'hallucinations' as puzzles to be solved rather than reasons to quit." },
{ dIdx:1, text:"I persist with an AI workflow even if the initial setup is complex or confusing." },
{ dIdx:1, text:"I am patient with the current limitations of AI, knowing it will improve through iteration." },

{ dIdx:2, text:"I always verify that my AI usage complies with my organization's data privacy policies." },
{ dIdx:2, text:"I feel a strong responsibility to check AI outputs for bias or ethical inconsistencies." },
{ dIdx:2, text:"I refuse to use AI tools that don't meet my institution's security standards." },
{ dIdx:2, text:"I actively document my AI workflows to ensure they can be audited if necessary." },
{ dIdx:2, text:"I prioritize ethical considerations over speed when using AI for critical tasks." },
{ dIdx:2, text:"I feel my use of AI enhances the integrity of my final professional output." },

{ dIdx:3, text:"I frequently advocate for the benefits of AI to colleagues who are hesitant." },
{ dIdx:3, text:"Other team members often come to me for advice on how to use AI effectively." },
{ dIdx:3, text:"I enjoy presenting my AI-driven successes in team meetings or shared forums." },
{ dIdx:3, text:"I actively encourage my department to adopt more advanced AI workflows." },
{ dIdx:3, text:"I feel like a 'champion' for digital transformation within my immediate network." },
{ dIdx:3, text:"I am comfortable leading an AI-focused initiative if given the opportunity." },

{ dIdx:4, text:"I see AI as a partner that augments my unique human skills rather than a rival." },
{ dIdx:4, text:"I feel secure about my future job prospects despite the rapid growth of AI." },
{ dIdx:4, text:"My professional identity feels strengthened by my ability to work with AI." },
{ dIdx:4, text:"I am excited rather than fearful about the evolution of my role in an AI-driven world." },
{ dIdx:4, text:"I don't feel 'replaced' when an AI performs a task I used to do manually." },
{ dIdx:4, text:"Working with AI makes me feel more creative and capable in my career." },

{ dIdx:5, text:"I am comfortable with the fact that AI outputs can vary even with the same input." },
{ dIdx:5, text:"I enjoy working in technology environments that are constantly changing." },
{ dIdx:5, text:"Uncertainty in software performance doesn't hinder my productivity." },
{ dIdx:5, text:"I find it easy to adapt to new interfaces and non-linear software logic." },
{ dIdx:5, text:"I am naturally drawn to tools that require probabilistic thinking." },
{ dIdx:5, text:"I rarely feel overwhelmed by the speed of new AI feature releases." },

{ dIdx:6, text:"I trust that my organization selects AI tools that are reliable and safe." },
{ dIdx:6, text:"I believe the AI outputs I receive are generally accurate and well-reasoned." },
{ dIdx:6, text:"I feel my organization is transparent about how AI is being used internally." },
{ dIdx:6, text:"I have confidence in the algorithms that power our core business tools." },
{ dIdx:6, text:"I trust that AI implementation in my firm is guided by sound logic." },
{ dIdx:6, text:"I feel comfortable sharing my data with internal AI systems for better results." },

{ dIdx:7, text:"My direct supervisor visibly uses AI to enhance their own work." },
{ dIdx:7, text:"Leadership consistently provides the resources I need to master AI tools." },
{ dIdx:7, text:"There is a clear vision from the top about how AI will transform our business." },
{ dIdx:7, text:"Executives frequently share updates on our AI strategy and progress." },
{ dIdx:7, text:"I feel supported by management when I try to innovate with new AI tools." },
{ dIdx:7, text:"Leadership prioritizes AI training as a core part of our professional growth." },

{ dIdx:8, text:"The rules for using AI in my daily tasks are clearly defined and easy to find." },
{ dIdx:8, text:"I understand the consequences of violating our organization's AI policies." },
{ dIdx:8, text:"Our AI guidelines are updated frequently enough to keep up with new tech." },
{ dIdx:8, text:"I know exactly which AI tools are 'approved' and which are restricted." },
{ dIdx:8, text:"The policy framework here makes me feel safe to use AI within set boundaries." },
{ dIdx:8, text:"I find our AI governance to be helpful rather than a purely restrictive force." },

{ dIdx:9, text:"AI has noticeably improved the quality of my professional deliverables." },
{ dIdx:9, text:"I save a significant amount of time each week by using AI for routine tasks." },
{ dIdx:9, text:"AI allows me to focus on high-level strategy rather than repetitive work." },
{ dIdx:9, text:"The creative quality of my work has increased since integrating AI." },
{ dIdx:9, text:"I can handle a higher volume of work without increasing my stress levels thanks to AI." },
{ dIdx:9, text:"I find that AI helps me bridge gaps in my own technical or specialized knowledge." },

{ dIdx:10, text:"AI tools are now a permanent and essential part of my daily work routine." },
{ dIdx:10, text:"I would find it very difficult to perform my job effectively without AI now." },
{ dIdx:10, text:"Most of my core workflows have an AI component built into them." },
{ dIdx:10, text:"I use AI consistently across every working day, not just for special projects." },
{ dIdx:10, text:"My team has standardized several processes around AI tool outputs." },
{ dIdx:10, text:"The use of AI in my role feels like a 'new normal' rather than a trend." },
{ dIdx:10, text:"I am confident in scaling my AI usage as new organizational needs arise." },
{ dIdx:10, text:"AI has successfully transitioned from a 'test' tool to a 'core' tool in my unit." }
    ];

    /* ===========================
       App state, rendering & behaviour
       =========================== */
    let radarChart = null;
    let pdfRadarChart = null;

    const app = {
        state: {
            view: 'hero',
            user: null,
            answers: new Array(allQuestions.length).fill(null),
            currentIdx: 0,
            isAdmin: false,
            responses: JSON.parse(localStorage.getItem('ai_instinct_v8') || '[]'),
            surveyId: 'RES-' + Math.random().toString(36).substr(2,8).toUpperCase()
        },

        init() {
            this.updateNav();
            this.render();
            // expose to console for debugging if needed
            window.aiInstinctApp = this;
        },

        updateNav() {
            const nav = document.getElementById('nav-actions');
            if (this.state.isAdmin) {
                nav.innerHTML = `<button onclick="app.logout()" class="text-rose-400 hover:text-rose-300 transition text-[10px] font-bold uppercase tracking-widest"><i class="fa-solid fa-power-off mr-2"></i>Logout</button>`;
            } else {
                nav.innerHTML = `<button onclick="app.navigate('admin')" class="text-slate-400 hover:text-cyan-400 transition text-[10px] font-bold uppercase tracking-widest"><i class="fa-solid fa-shield-halved mr-1"></i>Admin</button>`;
            }
        },

        render() {
            const port = document.getElementById('view-port');
            port.innerHTML = '';
            if (this.state.view === 'hero') this.renderHero(port);
            else if (this.state.view === 'reg') this.renderReg(port);
            else if (this.state.view === 'survey') this.renderSurvey(port);
            else if (this.state.view === 'results') this.renderResults(port);
            else if (this.state.view === 'admin') this.renderAdmin(port);
        },

        renderHero(p) {
            p.innerHTML = `
                <div class="text-center py-20">
                    <div class="inline-block px-4 py-1 rounded-full border border-cyan-500/30 bg-cyan-500/5 text-cyan-400 text-[10px] font-bold tracking-[0.3em] mb-8 uppercase">Scholarly Behavioral Diagnostic</div>
                    <h1 class="text-6xl font-extrabold mb-6 tracking-tight">
                        <span class="title-ai">AI</span> <span class="title-instinct italic serif">Instinct</span> <span class="title-index">Index</span>
                    </h1>
                    <p class="text-xl text-slate-400 mb-12 max-w-2xl mx-auto serif italic leading-relaxed">
                        A rigorous, scholarly psychometric instrument grounded in behavioral science and organizational research, assessing institutional and individual readiness for AI integration across 11 dimensions and 68 behavioral metrics.
                    </p>
                    <button onclick="app.navigate('reg')" class="bg-white text-slate-950 font-black px-12 py-5 rounded-full hover:bg-cyan-400 transition-all shadow-xl uppercase tracking-widest text-xs">Initialize Diagnostic</button>
                </div>
            `;
        },

        renderReg(p) {
            p.innerHTML = `
                <div class="max-w-xl mx-auto glass-card p-12 rounded-[2rem]">
                    <h2 class="text-2xl font-bold mb-8 uppercase tracking-tight text-center">Enrollment</h2>
                    <form id="reg-form" class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Participant Name</label>
                            <input required name="name" class="w-full bg-slate-950/50 border border-white/10 rounded-xl p-4 focus:border-cyan-500 outline-none text-white" value="${this.state.user ? this.state.user.name : ''}">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Corporate Email</label>
                            <input required type="email" name="email" class="w-full bg-slate-950/50 border border-white/10 rounded-xl p-4 focus:border-cyan-500 outline-none text-white" value="${this.state.user ? this.state.user.email : ''}">
                        </div>
                        <button type="submit" class="w-full bg-cyan-600 text-white font-bold py-5 rounded-xl hover:bg-cyan-500 transition-all uppercase tracking-widest text-xs">Begin ${allQuestions.length}-Point Analysis</button>
                    </form>
                </div>
            `;

            const form = document.getElementById('reg-form');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const fd = new FormData(form);
                    const name = (fd.get('name') || '').toString().trim();
                    const email = (fd.get('email') || '').toString().trim();
                    if (!name || !email) { alert('Please enter both name and email'); return; }
                    this.state.user = { name, email };
                    this.state.answers = new Array(allQuestions.length).fill(null);
                    this.state.currentIdx = 0;
                    this.state.surveyId = 'RES-' + Math.random().toString(36).substr(2,8).toUpperCase();
                    this.navigate('survey');
                });
            }
        },

        renderSurvey(p) {
            const q = allQuestions[this.state.currentIdx];
            const selected = this.state.answers[this.state.currentIdx];
            const dimName = dimensionsData[q.dIdx].name;

            p.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="pips-container">
                        ${allQuestions.map((_, i) => `<div class="pip ${i === this.state.currentIdx ? 'active' : (this.state.answers[i] ? 'completed' : '')}"></div>`).join('')}
                    </div>
                    <div id="survey-content" class="glass-card p-12 rounded-[2.5rem] border-t-4 border-cyan-500/50 min-h-[420px] flex flex-col justify-center relative">
                        <div class="text-cyan-400 font-bold text-[10px] tracking-[0.4em] uppercase mb-6 flex items-center">
                            <span class="h-px w-8 bg-cyan-400 mr-4"></span> Dimension: ${dimName}
                        </div>
                        <h2 class="text-3xl font-bold leading-tight mb-16 text-slate-100 serif italic">"${q.text}"</h2>
                        <div class="grid grid-cols-5 gap-3">
                            ${[1,2,3,4,5].map(v => `
                                <button onclick="app.recordAns(${v})" class="likert-btn ${selected === v ? 'selected' : ''} py-8 rounded-xl flex flex-col items-center">
                                    <span class="text-2xl font-black mb-1">${v}</span>
                                    <span class="text-[8px] uppercase tracking-tighter font-bold opacity-60">${["Strongly Disagree","Disagree","Neutral","Agree","Strongly Agree"][v-1]}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex justify-between mt-8 px-4">
                        <button onclick="app.prev()" class="text-slate-500 hover:text-white flex items-center text-xs font-bold tracking-widest ${this.state.currentIdx === 0 ? 'invisible' : ''}"><i class="fa-solid fa-chevron-left mr-2"></i> PREV</button>
                        <span class="text-[10px] text-slate-600 font-mono uppercase tracking-widest">Protocol ID: ${this.state.surveyId} | Metric ${this.state.currentIdx + 1} of ${allQuestions.length}</span>
                    </div>
                </div>
            `;
        },

        renderResults(p) {
            const res = this.processResults();
            p.innerHTML = `
                <div class="py-6 space-y-12">
                    <div class="text-center">
                        <div class="mb-4 text-[10px] font-bold text-cyan-500 tracking-[0.4em] uppercase">Diagnostic Prepared for:</div>
                        <h2 class="text-5xl font-extrabold mb-2 serif italic text-white">${this.state.user.name}</h2>
                        <div class="max-w-2xl mx-auto bg-white/5 p-6 rounded-2xl mt-8">
                            <div class="text-7xl font-black text-white mb-2">${res.overall}%</div>
                            <p class="text-sm font-bold text-cyan-400 uppercase tracking-widest mb-4">Maturity Status: ${this.getClass(res.overall)}</p>
                            <p class="text-xs text-slate-400 leading-relaxed serif italic">
                                "Your profile reflects a ${this.getClass(res.overall).toLowerCase()} level of AI alignment. This diagnostic indicates strength in ${res.scores.sort((a,b)=>b.score-a.score)[0].name} and identifies specific developmental opportunities."
                            </p>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-10">
                        <div class="glass-card p-10 rounded-[2.5rem] sticky top-24">
                            <div class="aspect-square"><canvas id="final-radar"></canvas></div>
                            <div class="mt-8">
                                <button onclick="app.downloadPDF()" class="w-full bg-white text-slate-950 font-black py-6 rounded-2xl hover:bg-cyan-400 transition-all flex items-center justify-center gap-4 uppercase tracking-widest text-xs shadow-xl">
                                    <i class="fa-solid fa-file-pdf text-xl"></i> Export Comprehensive Report
                                </button>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest text-slate-500 border-b border-white/5 pb-2">Dimension Scores</h3>
                            <div class="grid gap-4">
                                ${res.scores.map(s => `
                                    <div class="glass-card p-6 rounded-2xl border-l-4 ${s.score >= 75 ? 'border-teal-500' : (s.score >= 50 ? 'border-cyan-500' : 'border-rose-500')}">
                                        <div class="flex justify-between items-start mb-2">
                                            <div class="text-xs font-bold text-slate-200 uppercase">${s.name}</div>
                                            <div class="text-2xl font-black text-white">${s.score}%</div>
                                        </div>
                                        <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                                            <div class="h-full ${s.score >= 75 ? 'bg-teal-500' : (s.score >= 50 ? 'bg-cyan-500' : 'bg-rose-500')}" style="width: ${s.score}%"></div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            setTimeout(() => this.drawRadar('final-radar', res.scores), 120);
        },

        renderAdmin(p) {
            if (!this.state.isAdmin) {
                p.innerHTML = `
                    <div class="max-w-md mx-auto glass-card p-12 rounded-[3rem] text-center">
                        <h2 class="text-xl font-bold mb-8 uppercase tracking-widest">Admin Entry</h2>
                        <input type="password" id="admin-p" class="w-full bg-slate-950/50 border border-white/10 p-5 rounded-2xl mb-6 outline-none focus:border-cyan-500 text-center text-3xl tracking-[0.5em]" placeholder="••••">
                        <button onclick="app.login()" class="w-full bg-cyan-700 text-white font-black py-5 rounded-2xl hover:bg-cyan-600 transition-all uppercase tracking-widest text-xs">Authorize</button>
                    </div>
                `;
                return;
            }
            p.innerHTML = `
                <div class="space-y-8">
                    <div class="flex flex-col md:flex-row justify-between items-end border-b border-white/5 pb-6 gap-4">
                        <h2 class="text-4xl font-extrabold uppercase">Diagnostic <span class="title-instinct">Console</span></h2>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="app.showShareModal()" class="bg-indigo-600 text-white px-5 py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest"><i class="fa-solid fa-share-nodes mr-2"></i>Distribute</button>
                            <button onclick="app.exportCSV()" class="bg-slate-800 text-white px-5 py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest">Master Export</button>
                            <button onclick="app.adminTeamDownload()" class="bg-green-600 text-white px-5 py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest"><i class="fa-solid fa-file-pdf mr-2"></i>Team Report</button>
                            <button onclick="app.resetSystem()" class="bg-rose-900/40 text-rose-400 px-5 py-3 rounded-lg text-[10px] font-bold uppercase tracking-widest">System Reset</button>
                        </div>
                    </div>
                    <div class="glass-card rounded-[2rem] overflow-hidden">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-white/5 text-[10px] uppercase font-bold text-slate-500 tracking-widest">
                                <tr><th class="px-8 py-4">Subject</th><th class="px-8 py-4 text-center">Score</th><th class="px-8 py-4 text-right">Actions</th></tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                ${this.state.responses.map((r, i) => `
                                    <tr class="hover:bg-white/5 transition">
                                        <td class="px-8 py-6"><div class="font-bold text-slate-200">${r.user.name}</div><div class="text-[9px] font-mono text-slate-600">${r.user.email}</div></td>
                                        <td class="px-8 py-6 text-center"><span class="font-black ${r.overall >= 75 ? 'text-teal-400' : (r.overall >= 50 ? 'text-cyan-400' : 'text-rose-400')}">${r.overall}%</span></td>
                                        <td class="px-8 py-6 text-right space-x-4">
                                            <button onclick="app.retake(${i})" class="text-[9px] font-bold text-amber-500 uppercase">Retake</button>
                                            <button onclick="app.adminIndivDownload(${i})" class="text-slate-500 hover:text-cyan-400"><i class="fa-solid fa-file-pdf"></i></button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        },

        showShareModal() {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.id = 'share-modal';
            overlay.innerHTML = `
                <div class="glass-card p-8 rounded-2xl max-w-sm w-full text-center">
                    <h3 class="text-xl font-bold mb-4 uppercase">Distribute Survey</h3>
                    <div class="grid gap-3">
                        <button onclick="app.shareByEmail()" class="bg-white/5 p-3 rounded-xl hover:bg-white/10"><i class="fa-solid fa-envelope mr-2 text-cyan-400"></i> Email Invite</button>
                        <button onclick="app.shareByWhatsApp()" class="bg-white/5 p-3 rounded-xl hover:bg-white/10"><i class="fa-brands fa-whatsapp mr-2 text-emerald-400"></i> WhatsApp</button>
                    </div>
                    <button onclick="document.getElementById('share-modal').remove()" class="mt-6 text-xs text-slate-400 uppercase font-bold">Close</button>
                </div>
            `;
            document.body.appendChild(overlay);
        },

        shareByEmail() {
            const recipient = prompt("Enter recipient email:");
            if (!recipient) return;
            const subject = "AI Instinct Index Survey Invite";
            const body = `Please participate in the AI Instinct Index Behavioral Diagnostic: ${window.location.href}`;
            window.location.href = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        },

        shareByWhatsApp() {
            const num = prompt("Enter phone number with country code (e.g., 919876543210):");
            if (!num) return;
            const msg = `Join the AI Instinct Index Behavioral Diagnostic Survey: ${window.location.href}`;
            window.open(`https://wa.me/${num.replace(/\D/g,'')}?text=${encodeURIComponent(msg)}`, '_blank');
        },

        navigate(v) { this.state.view = v; this.updateNav(); this.render(); },

        login() { const v = document.getElementById('admin-p'); if (v && v.value === CONFIG.ADMIN_PASS) { this.state.isAdmin = true; this.navigate('admin'); } else alert('Invalid Credentials'); },

        logout() { this.state.isAdmin = false; this.navigate('hero'); },

        recordAns(v) {
            this.state.answers[this.state.currentIdx] = v;
            this.render();
            setTimeout(() => {
                const content = document.getElementById('survey-content');
                if (content) content.classList.add('fade-out');
                setTimeout(() => {
                    if (this.state.currentIdx < allQuestions.length - 1) {
                        this.state.currentIdx++;
                        this.render();
                    } else {
                        this.complete();
                    }
                }, 140);
            }, 160);
        },

        prev() { if (this.state.currentIdx > 0) { this.state.currentIdx--; this.render(); } },

        retake(idx) {
            const r = this.state.responses[idx];
            if (!r) return;
            this.state.user = r.user;
            this.state.answers = new Array(allQuestions.length).fill(null);
            this.state.currentIdx = 0;
            this.state.isAdmin = false;
            this.navigate('reg');
        },

        resetSystem() {
            if (confirm('DANGER: This will delete ALL responses. Proceed?')) {
                localStorage.removeItem('ai_instinct_v8');
                this.state.responses = [];
                this.state.user = null;
                this.state.answers = new Array(allQuestions.length).fill(null);
                this.state.currentIdx = 0;
                this.state.isAdmin = false;
                this.navigate('reg');
            }
        },

        async complete() {
            const res = this.processResults();
            const record = { id: this.state.surveyId, user: this.state.user, ...res, timestamp: new Date().toLocaleString() };
            this.state.responses.push(record);
            localStorage.setItem('ai_instinct_v8', JSON.stringify(this.state.responses));
            this.navigate('results');
            try { await this.generatePDF(record); } catch(e) { console.error('PDF gen failed', e); }
        },

        processResults() {
            const scores = dimensionsData.map((d, dIdx) => {
                const qIdxs = allQuestions.map((q,i) => q.dIdx === dIdx ? i : -1).filter(i => i !== -1);
                const sum = qIdxs.reduce((acc, i) => acc + (this.state.answers[i] || 0), 0);
                const score = qIdxs.length ? Math.round((sum / (qIdxs.length * 5)) * 100) : 0;
                return { ...d, score };
            });
            const overall = Math.round(scores.reduce((a,b) => a + b.score, 0) / scores.length);
            return { scores, overall };
        },

        getClass(s) { if (s >= 75) return "High (Leading)"; if (s >= 50) return "Medium (Developing)"; return "Low (Emerging)"; },

        drawRadar(canvasId, scores, forPdf = false) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return null;
            const ctx = canvas.getContext('2d');
            if (forPdf && pdfRadarChart) pdfRadarChart.destroy();
            else if (!forPdf && radarChart) radarChart.destroy();

            const labelsWithPct = scores.map(s => `${s.name} (${s.score}%)`);
            const cfg = {
                type: 'radar',
                data: {
                    labels: scores.map(s => s.name),
                    datasets: [{
                        label: 'Score',
                        data: scores.map(s => s.score),
                        backgroundColor: forPdf ? 'rgba(45, 212, 191, 0.3)' : 'rgba(0,240,255,0.15)',
                        borderColor: forPdf ? '#0d9488' : '#00f0ff',
                        borderWidth: forPdf ? 3 : 2,
                        pointBackgroundColor: forPdf ? '#0f172a' : '#00f0ff',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointRadius: forPdf ? 6 : 4
                    }]
                },
                options: {
                    animation: !forPdf,
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            min: 0, max: 100,
                            ticks: { 
                                display: true,
                                stepSize: 20,
                                backdropColor: 'transparent',
                                color: forPdf ? '#64748b' : 'rgba(255,255,255,0.3)',
                                font: { size: forPdf ? 10 : 8 }
                            }, 
                            grid: { 
                                color: forPdf ? 'rgba(0,0,0,0.15)' : 'rgba(255,255,255,0.05)',
                                circular: true
                            },
                            pointLabels: { 
                                color: forPdf ? '#1e293b' : '#94a3b8', 
                                font: { 
                                    size: forPdf ? 16 : 10,
                                    weight: 'bold',
                                    family: 'Helvetica'
                                } 
                            },
                            angleLines: {
                                color: forPdf ? 'rgba(0,0,0,0.15)' : 'rgba(255,255,255,0.05)'
                            }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            };
            const chartInstance = new Chart(ctx, cfg);
            if (forPdf) pdfRadarChart = chartInstance; else radarChart = chartInstance;
            return chartInstance;
        },

        async generatePDF(record) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'portrait' });
            
            // Design Constants
            const colors = {
                slate900: [15, 23, 42],
                slate800: [30, 41, 59],
                slate700: [51, 65, 85],
                slate500: [100, 116, 139],
                slate100: [241, 245, 249],
                cyan500: [6, 182, 212],
                teal500: [20, 184, 166],
                rose500: [244, 63, 94],
                white: [255, 255, 255],
                cardBg: [250, 250, 250]
            };
            
            const layout = {
                margin: 15,
                width: 210,
                height: 297,
                contentW: 180, // 210 - 2*15
                lineH: 5
            };

            // --- Helpers ---
            const setFont = (type = 'normal', size = 10, color = colors.slate700) => {
                doc.setFont('helvetica', type);
                doc.setFontSize(size);
                doc.setTextColor(...color);
            };

            const addHeader = (title) => {
                doc.setFillColor(...colors.slate900);
                doc.rect(0, 0, layout.width, 20, 'F');
                setFont('bold', 12, colors.white);
                doc.text('AI INSTINCT INDEX', layout.margin, 13);
                setFont('normal', 10, colors.cyan500);
                const pageInfo = `Page ${doc.internal.getNumberOfPages()}`;
                doc.text(pageInfo, layout.width - layout.margin, 13, { align: 'right' });
            };

            const addFooter = () => {
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    // Skip Footer on Page 1 (Cover)
                    if (i === 1) continue;
                    setFont('normal', 8, colors.slate500);
                    doc.text(`AI Instinct Index created by sreejith@futureowork.com`, layout.margin, layout.height - 10);
                    doc.text(`Page ${i}`, layout.width - layout.margin, layout.height - 10, { align: 'right' });
                }
            };
            
            const writeWrapped = (txt, x, y, maxW, lineHeight = 5, color = colors.slate700, size=9) => {
                setFont('normal', size, color);
                const lines = doc.splitTextToSize(txt, maxW);
                doc.text(lines, x, y);
                return lines.length * lineHeight;
            };

            // --- PAGE 1: COVER ---
            doc.setFillColor(...colors.slate900);
            doc.rect(0, 0, layout.width, layout.height, 'F');

            // Abstract Decor
            doc.setDrawColor(...colors.cyan500);
            doc.setLineWidth(0.5);
            doc.circle(layout.width + 20, 50, 80, 'S');
            doc.circle(layout.width + 20, 50, 70, 'S');
            
            doc.setFillColor(...colors.slate800);
            doc.circle(-20, layout.height - 50, 60, 'F');

            // Content
            let y = 80;
            setFont('bold', 12, colors.cyan500);
            doc.text('BEHAVIORAL DIAGNOSTIC REPORT', layout.margin, y, null, null, "left");
            
            y += 15;
            setFont('bold', 42, colors.white);
            doc.text('AI INSTINCT', layout.margin, y);
            y += 15;
            doc.text('INDEX', layout.margin, y);
            
            y += 25;
            setFont('normal', 14, colors.slate500);
            doc.text('Prepared for:', layout.margin, y);
            y += 10;
            setFont('bold', 22, colors.white);
            doc.text(record.user.name.toUpperCase(), layout.margin, y);
            y += 8;
            setFont('normal', 11, colors.cyan500);
            doc.text(record.user.email, layout.margin, y);

            // Large Score Badge on Cover
            y += 40;
            const scoreSize = 30;
            const scoreColor = record.overall >= 75 ? colors.teal500 : (record.overall >= 50 ? colors.cyan500 : colors.rose500);
            doc.setDrawColor(...scoreColor);
            doc.setLineWidth(2);
            doc.circle(layout.margin + scoreSize, y + scoreSize, scoreSize, 'S');
            setFont('bold', 28, scoreColor);
            doc.text(`${record.overall}%`, layout.margin + scoreSize, y + scoreSize + 3, {align: 'center'});
            
            // Classification text below score
            const classification = record.overall >= 75 ? "STRONG" : (record.overall >= 50 ? "MODERATE" : "EMERGING");
            setFont('bold', 14, scoreColor);
            doc.text(classification, layout.margin + scoreSize, y + scoreSize + 15, {align: 'center'});

            setFont('bold', 10, colors.slate500);
            doc.text('OVERALL READINESS', layout.margin + scoreSize, y + (scoreSize*2) + 12, {align: 'center'});

            doc.text(new Date().toLocaleDateString(), layout.width - layout.margin, layout.height - 15, { align: 'right' });

            // --- PAGE 2: EXECUTIVE SUMMARY & SNAPSHOT ---
            doc.addPage();
            addHeader();
            y = 35; // Start below header

            // Title
            setFont('bold', 16, colors.slate900);
            doc.text('EXECUTIVE SUMMARY', layout.margin, y);
            y += 10;

            // Important Diagnostic Disclaimer
            setFont('bold', 11, colors.slate800);
            const disclaimerText = "This is not a judgment of performance. It is a diagnostic for readiness.";
            doc.text(disclaimerText, layout.margin, y);
            y += 12;

            // Two columns: Text Left, Key Right
            // NOTE: Adjusted width to ensure no overlap
            const col1W = 110; 
            const col2X = layout.margin + col1W + 15;
            let textEndY = y;
            
            // Introduction Text (Prefix)
            const prefix = [
                "This report assesses behavioral readiness for AI adoption — not technical capability.",
                "Most AI initiatives fail because of human behavior, not technology. This assessment evaluates how individuals and teams engage with AI across 11 critical behavioral dimensions.",
                "Your results highlight natural acceleration points, potential friction areas, and specific behavioral levers for leadership focus."
            ];
            
            prefix.forEach(p => {
                const h = writeWrapped(p, layout.margin, textEndY, col1W, 5, colors.slate700, 10);
                textEndY += h + 4;
            });
            
            // Legend/Key (Right Column)
            let keyY = y; 
            // Draw Key Box Background
            doc.setFillColor(...colors.slate100);
            doc.roundedRect(col2X - 5, keyY - 5, 60, 45, 3, 3, 'F');

            const drawKeyItem = (color, label, range, ky) => {
                doc.setFillColor(...color);
                doc.circle(col2X, ky - 1, 2, 'F');
                setFont('bold', 9, colors.slate800);
                doc.text(label, col2X + 5, ky);
                setFont('normal', 8, colors.slate500);
                doc.text(range, col2X + 5, ky + 4);
            };
            
            drawKeyItem(colors.teal500, "STRONG", "Scores > 75%", keyY + 5);
            drawKeyItem(colors.cyan500, "MODERATE", "Scores 50-75%", keyY + 17);
            drawKeyItem(colors.rose500, "EMERGING", "Scores < 50%", keyY + 29);

            const keyEndY = keyY + 45;

            // Ensure Radar starts below both columns
            y = Math.max(textEndY, keyEndY) + 15;

            // Radar Chart Integration
            // Capture canvas safely
            try {
                this.drawRadar && this.drawRadar('radar-canvas', record.scores, true);
                await new Promise(r => setTimeout(r, 600));
                const canvas = document.getElementById('radar-canvas');
                if (canvas) {
                    const img = canvas.toDataURL('image/png', 1.0);
                    // Place radar centered
                    const imgSize = 100;
                    const xPos = (layout.width - imgSize) / 2;
                    doc.addImage(img, 'PNG', xPos, y, imgSize, imgSize);
                    y += imgSize + 10;
                }
            } catch(e) { console.error("Radar error", e); y += 10; }

            // Strengths & Weaknesses (Bottom of Page 2)
            const sorted = [...record.scores].sort((a,b) => b.score - a.score);
            const top3 = sorted.slice(0, 3);
            const low3 = sorted.slice(-3).reverse();

            const drawStatBox = (title, items, x, color) => {
                // Check if space exists, else new page
                if (y + 50 > layout.height) return;

                doc.setFillColor(...colors.cardBg);
                doc.roundedRect(x, y, 85, 45, 3, 3, 'F');
                doc.setDrawColor(...colors.slate100);
                doc.rect(x, y, 85, 45, 'S');
                
                // Border top accent
                doc.setFillColor(...color);
                doc.rect(x, y, 85, 2, 'F');
                
                setFont('bold', 10, colors.slate900);
                doc.text(title, x + 5, y + 10);
                
                let iy = y + 18;
                items.forEach(item => {
                    setFont('bold', 9, color);
                    doc.text(`${item.score}%`, x + 5, iy);
                    setFont('normal', 9, colors.slate700);
                    doc.text(item.name, x + 16, iy);
                    iy += 8;
                });
            };

            if (y + 50 < layout.height) {
                 drawStatBox("TOP STRENGTHS", top3, layout.margin, colors.teal500);
                 drawStatBox("DEVELOPMENT PRIORITIES", low3, layout.width/2 + 5, colors.rose500);
            }

            // --- PAGE 3+: DIMENSION CARDS ---
            doc.addPage();
            addHeader();
            y = 35;
            setFont('bold', 16, colors.slate900);
            doc.text('DETAILED ANALYSIS', layout.margin, y);
            y += 10;

            // Loop Dimensions
            record.scores.forEach((s, i) => {
                const checklistItems = s.checklist || ["No checklist available."];
                
                // Check page break with buffer (approx 90mm needed per card)
                if (y + 90 > layout.height - 20) {
                    doc.addPage();
                    addHeader();
                    y = 35;
                }

                let currentY = y;
                
                // Title Area
                const scoreCol = s.score >= 75 ? colors.teal500 : (s.score >= 50 ? colors.cyan500 : colors.rose500);
                
                // Title
                setFont('bold', 12, colors.slate800);
                doc.text(s.name.toUpperCase(), layout.margin + 8, currentY + 10);
                
                // Score Badge
                doc.setFillColor(...scoreCol);
                doc.roundedRect(layout.width - layout.margin - 20, currentY + 5, 15, 8, 2, 2, 'F');
                setFont('bold', 9, colors.white);
                doc.text(`${s.score}%`, layout.width - layout.margin - 12.5, currentY + 10, {align: 'center'});

                // Grid: Left (Scientific) | Right (Guidance)
                const leftX = layout.margin + 8;
                const rightX = layout.width / 2 + 5;
                const colW = (layout.contentW / 2) - 12;
                let contentY = currentY + 20;

                // Left Col
                setFont('bold', 9, colors.slate900);
                doc.text('SCIENTIFIC CONTEXT', leftX, contentY);
                writeWrapped(s.scientific || '', leftX, contentY + 5, colW, 4, colors.slate500, 8);

                // Right Col
                setFont('bold', 9, colors.slate900);
                doc.text('TRANSFORMATION GUIDANCE', rightX, contentY);
                writeWrapped(s.dev || '', rightX, contentY + 5, colW, 4, colors.slate500, 8);

                // Leader Checklist (Bottom Strip within card)
                const checkY = currentY + 55;
                doc.setDrawColor(...colors.slate100);
                doc.line(leftX, checkY - 5, layout.width - layout.margin - 8, checkY - 5); // Divider

                setFont('bold', 9, colors.slate900);
                doc.text("LEADER'S CHECKLIST", leftX, checkY);
                
                let checkCursorY = checkY + 7;
                checklistItems.forEach((c) => {
                   doc.setFillColor(...colors.cyan500);
                   doc.circle(leftX + 2, checkCursorY - 1, 1.5, 'F');
                   
                   setFont('normal', 8, colors.slate700);
                   const checkLines = doc.splitTextToSize(c, layout.contentW - 20);
                   doc.text(checkLines, leftX + 6, checkCursorY);
                   
                   checkCursorY += (checkLines.length * 4) + 2; 
                });

                const totalCardH = (checkCursorY - y) + 5;
                
                // Draw Card Container Border
                doc.setDrawColor(...colors.slate100);
                doc.roundedRect(layout.margin, y, layout.contentW, totalCardH, 3, 3, 'S');
                
                // Draw left accent bar
                doc.setFillColor(...scoreCol);
                doc.roundedRect(layout.margin, y, 2, totalCardH, 0, 0, 'F');

                y += totalCardH + 10;
            });

            // Finalize
            addFooter();
            const filename = `AI_Instinct_Report_${record.user.name.replace(/\s+/g,'_')}.pdf`;
            doc.save(filename);
        },

        adminIndivDownload(idx) { this.generatePDF(this.state.responses[idx]); },

        downloadPDF() {
            const current = this.state.responses.find(r => r.id === this.state.surveyId);
            if (current) this.generatePDF(current); else alert('No current report found. Complete the survey first.');
        },
        
        async adminTeamDownload() {
            try {
                if (!this.state || !this.state.responses || this.state.responses.length === 0) { alert('No responses.'); return; }
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ unit: 'mm', format: 'a4' });
                const m = 15;
                const w = 210;
                
                // --- Team Cover ---
                doc.setFillColor(15, 23, 42);
                doc.rect(0,0,w,297,'F');
                doc.setFont('helvetica','bold'); 
                doc.setTextColor(255,255,255);
                doc.setFontSize(28);
                doc.text('TEAM AGGREGATE', m, 100);
                doc.text('REPORT', m, 112);
                doc.setFontSize(12);
                doc.setTextColor(6, 182, 212);
                doc.text(`${this.state.responses.length} PARTICIPANTS`, m, 125);
                doc.text(new Date().toLocaleDateString(), m, 132);

                // --- List Pages ---
                doc.addPage();
                let y = 20;
                doc.setFontSize(16); doc.setTextColor(15,23,42);
                doc.text('TEAM ROSTER', m, y);
                y += 15;

                this.state.responses.forEach((r, i) => {
                    if (y > 260) { doc.addPage(); y = 20; }
                    
                    // Card background
                    doc.setFillColor(248, 250, 252);
                    doc.roundedRect(m, y, 180, 25, 2, 2, 'F');
                    
                    // Score Box
                    const col = r.overall >= 75 ? [20, 184, 166] : (r.overall >= 50 ? [6, 182, 212] : [244, 63, 94]);
                    doc.setFillColor(...col);
                    doc.roundedRect(m, y, 25, 25, 2, 2, 'F');
                    doc.setTextColor(255,255,255);
                    doc.setFontSize(12);
                    doc.text(`${r.overall}%`, m + 12.5, y + 16, {align:'center'});

                    // Name Info
                    doc.setTextColor(30, 41, 59);
                    doc.setFontSize(11);
                    doc.text(r.user.name, m + 35, y + 10);
                    doc.setTextColor(100, 116, 139);
                    doc.setFontSize(9);
                    doc.text(r.user.email, m + 35, y + 16);

                    y += 35;
                });

                doc.save(`AI_Team_Report_${new Date().toISOString().slice(0,10)}.pdf`);
            } catch (ex) {
                console.error('Team PDF error', ex);
                alert('Team PDF generation failed.');
            }
        },

        exportCSV() {
            let csv = "ID,Name,Email,Overall," + dimensionsData.map(d => d.name).join(",") + "\n";
            this.state.responses.forEach(r => csv += `${r.id},${r.user.name},${r.user.email},${r.overall}%,` + r.scores.map(s => s.score).join(",") + "\n");
            const b = new Blob([csv], { type: 'text/csv' }); const u = URL.createObjectURL(b);
            const a = document.createElement('a'); a.href = u; a.download = `AI_Master_Data.csv`; a.click();
        }
    };

    window.onload = () => app.init();
    </script>
</body>
</html>